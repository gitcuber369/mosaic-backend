# Database Schema Documentation

## Story Schema
A `Story` represents a user-generated story with multiple chapters, ratings, and metadata.

### Fields
| Field              | Type       | Description                                                                 |
|--------------------|------------|-----------------------------------------------------------------------------|
| **_id**           | ObjectId   | Unique identifier for the story, automatically generated by MongoDB.       |
| **userId**        | ObjectId   | Reference to the `User` who created the story.                              |
| **text**          | string     | (Deprecated) Original story text, replaced by `chapters`.                   |
| **style**         | string     | The style or theme of the story (e.g., "Adventure", "Fantasy").          |
| **voice**         | string     | The voice type used for audio narration.                                    |
| **image**         | string     | URL or path to the story's cover image.                                     |
| **audioUrl**      | string     | (Deprecated) URL to the audio file for the entire story.                    |
| **rating**        | number     | Average user rating for the story, ranging from 1 to 5.                     |
| **ratingCount**   | number     | Total number of ratings received for the story.                             |
| **createdAt**     | Date       | Timestamp when the story was created.                                       |
| **chapters**      | Array      | An array of chapters, each containing:                                      |
| - **title**       | string     | Title of the chapter.                                                       |
| - **description** | string     | Brief description or summary of the chapter.                                |
| - **text**        | string     | Full text content of the chapter.                                           |
| - **audioUrl**    | string     | URL to the audio file for the chapter.                                      |
| - **generated**   | boolean    | Indicates if the chapter has been generated.                                |
| - **audioGenerated** | boolean | Indicates if the audio for the chapter has been generated.                  |
| **ageGroup**      | string     | Target age group for the story (e.g., "6-8 years").                        |
| **gender**        | string     | Gender of the main character (e.g., "Male", "Female").                   |
| **name**          | string     | Name of the main character.                                                 |
| **character**     | string     | Description of the main character (e.g., "A brave knight").               |
| **hobbies**       | Array      | List of hobbies or interests of the main character.                         |

### TypeScript Code
```typescript
import { ObjectId } from 'mongodb';

export interface Story {
  _id?: ObjectId;
  userId: ObjectId;
  text?: string; // Deprecated: use chapters instead
  style: string;
  voice: string;
  image: string; // URL or path to the image
  audioUrl?: string; // URL to the generated audio file (mp3)
  rating: number; // Average user rating for the story (1-5)
  ratingCount?: number; // Number of ratings received
  createdAt: Date;
  chapters: Array<{
    title: string;
    description?: string;
    text: string;
    audioUrl?: string;
    generated: boolean;
    audioGenerated?: boolean;
  }>;
  ageGroup: string;
  gender: string;
  name: string;
  character: string;
  hobbies: string[];
}
```

---

## SupportIssue Schema
A `SupportIssue` represents a user-reported issue or feedback.

### Fields
| Field          | Type       | Description                                                    |
|----------------|------------|----------------------------------------------------------------|
| **_id**       | ObjectId   | Unique identifier for the support issue, automatically generated by MongoDB. |
| **type**      | string     | Type of support issue (e.g., "Bug Report", "Feature Request"). |
| **description** | string   | Detailed description of the issue.                             |
| **createdAt** | Date       | Timestamp when the support issue was created.                  |

### TypeScript Code
```typescript
import { ObjectId } from 'mongodb';

export interface SupportIssue {
  _id?: ObjectId;
  type: string;
  description: string;
  createdAt: Date;
}
```

---

## User Schema
A `User` represents an individual using the platform, with details about their preferences, subscriptions, and activity.

### Fields
| Field                  | Type       | Description                                                                 |
|------------------------|------------|-----------------------------------------------------------------------------|
| **_id**               | ObjectId   | Unique identifier for the user, automatically generated by MongoDB.        |
| **name**              | string     | Full name of the user.                                                     |
| **email**             | string     | Email address of the user.                                                 |
| **profile**           | string     | URL or path to the user's profile picture.                                 |
| **gender**            | string     | Gender of the user (e.g., "Male", "Female", "Other").                  |
| **ageGroup**          | string     | Age group of the user (e.g., "18-24 years").                              |
| **hobbies**           | Array      | List of hobbies or interests of the user.                                  |
| **isPremium**         | boolean    | Indicates if the user has a premium subscription.                          |
| **subscriptionId**    | string     | Identifier for the user's subscription plan.                               |
| **tokens**            | number     | Number of tokens available for the user to use.                            |
| **dailyStoryCount**   | number     | Number of stories the user can create daily.                               |
| **preferences**       | Array      | List of user preferences (e.g., "Fantasy", "Adventure").                |
| **createdAt**         | Date       | Timestamp when the user account was created.                               |
| **storyCreationCredits** | number  | (Deprecated) Credits for creating stories, replaced by `storyListenCredits`. |
| **storyListenCredits** | number    | Credits available for generating and listening to stories.                 |
| **listenedChapters**  | Array      | List of chapters the user has listened to, grouped by story, containing:   |
| - **storyId**         | ObjectId   | Reference to the `Story` schema.                                           |
| - **chapters**        | Array      | Array of chapter indices the user has listened to.                         |
| **stripeCustomerId**  | string     | Stripe customer ID for payment processing.                                 |
| **stripeSubscriptionId** | string  | Stripe subscription ID for the user's premium plan.                        |
| **premiumExpiresAt**  | Date       | Expiration date of the user's premium subscription.                        |

### TypeScript Code
```typescript
import { ObjectId } from 'mongodb';

export interface User {
  _id?: ObjectId;
  name: string;
  email: string;
  profile: string;
  gender: string;
  ageGroup: string;
  hobbies: string[];
  isPremium: boolean;
  subscriptionId: string;
  tokens: number;
  dailyStoryCount: number;
  preferences: string[];
  createdAt: Date;
  storyCreationCredits?: number; // Deprecated - now using storyListenCredits for both generation and listening
  storyListenCredits: number;
  listenedChapters?: Array<{ storyId: ObjectId; chapters: number[] }>;
  stripeCustomerId?: string;
  stripeSubscriptionId?: string;
  premiumExpiresAt?: Date;
}
```
